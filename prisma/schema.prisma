generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  role      String   // ADMIN, CASHIER, KITCHEN, WAITER
  pin       String   // 4-digit PIN (hashed)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id        String    @id @default(uuid())
  name      String
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Product {
  id          String      @id @default(uuid())
  name        String
  description String?
  price       Float
  isAvailable Boolean     @default(true)
  image       String?     @default("/placeholder.svg")
  categoryId  String
  category    Category    @relation(fields: [categoryId], references: [id])
  type        String?     @default("HOT") // HOT, ICED, NONE
  size        String?     @default("REGULAR") // S, M, L, REGULAR
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
  recipes     Recipe[]
}

model Ingredient {
  id           String   @id @default(uuid())
  name         String
  unit         String   // kg, L, pcs, etc.
  currentStock Float
  minStock     Float
  maxStock     Float
  cost         Float
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  recipes      Recipe[]
}

model Recipe {
  id           String     @id @default(uuid())
  productId    String
  product      Product    @relation(fields: [productId], references: [id])
  ingredientId String
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
  quantity     Float      // Amount of ingredient used per product
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([productId, ingredientId])
}

model Customer {
  id            String    @id @default(uuid())
  name          String
  phone         String?
  email         String?
  dateOfBirth   DateTime?
  loyaltyPoints Int       @default(0)
  totalSpent    Float     @default(0)
  visitCount    Int       @default(0)
  lastVisit     DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  orders        Order[]
}

model Promotion {
  id            String   @id @default(uuid())
  name          String
  description   String?
  code          String   @unique
  discountType  String   // percentage, fixed
  discountValue Float
  startDate     DateTime
  endDate       DateTime
  isActive      Boolean  @default(true)
  orders        Order[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Order {
  id            String      @id @default(uuid())
  orderNumber   String      // e.g. No. 01
  status        String      @default("COMPLETED") // PENDING, COMPLETED, HOLD, CANCELLED
  total         Float
  subtotal      Float
  tax           Float
  discount      Float       @default(0)
  promoId       String?
  promotion     Promotion?  @relation(fields: [promoId], references: [id])
  paymentMethod String      @default("CASH") // BANK_NOTE, QR_CODE
  customerId    String?
  customer      Customer?   @relation(fields: [customerId], references: [id])
  items         OrderItem[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  cancellationReason String? // Reason for cancellation (if status is CANCELLED)
  beeperNumber  String?     // Added for consistency
  pointsRedeemed Int?       @default(0) // Added for consistency
  taxAmount     Float?      @default(0) // Added for consistency
}

model Setting {
  key   String @id
  value String
}

model Shift {
  id            String    @id @default(uuid())
  userId        String?   // User who opened the shift
  startTime     DateTime  @default(now())
  endTime       DateTime?
  startCash     Float     @default(0)
  endCash       Float?
  actualCash    Float?    // Actual cash counted at end of shift
  difference    Float?    // endCash - actualCash
  cashPayments  Float     @default(0) // Total cash payments received during shift
  status        String    @default("OPEN") // OPEN, CLOSED
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String?
  product   Product? @relation(fields: [productId], references: [id])
  name      String  // Snapshot of product name
  price     Float   // Snapshot of price
  quantity  Int
  total     Float
}
